<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>MOODVERSE ‚Äî Your Emotional Universe</title>
<meta name="description" content="Generate your unique AI soul portrait. A daily emotional check-in that creates living art from your feelings."/>
<meta property="og:title" content="MOODVERSE ‚Äî Your Emotional Universe"/>
<meta property="og:description" content="Generate your unique AI soul portrait. Check in daily. Build your inner universe."/>
<meta property="og:type" content="website"/>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400;1,700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root {
  --bg:#07080F; --bg2:#0C0E1A; --surface:#111426; --surface2:#161930;
  --border:#1E2240; --border2:#252850;
  --text:#EEF0FF; --text-dim:#5A607A; --text-mid:#9098B8;
  --gold:#F0C060; --gold2:#FFE08A; --violet:#8B5CF6; --pink:#EC4899;
  --cyan:#22D3EE; --emerald:#10B981; --orange:#F97316;
  --radius:20px; --radius-sm:12px;
}
html,body{height:100%;background:var(--bg);color:var(--text);font-family:'Outfit',sans-serif;overflow-x:hidden}
#stars-canvas{position:fixed;inset:0;z-index:0;pointer-events:none}
#app{position:relative;z-index:1;min-height:100vh;display:flex;flex-direction:column}

/* NAV */
nav{position:sticky;top:0;z-index:100;padding:16px 32px;display:flex;align-items:center;justify-content:space-between;background:rgba(7,8,15,0.9);backdrop-filter:blur(20px);border-bottom:1px solid var(--border)}
.nav-logo{font-family:'Playfair Display',serif;font-size:24px;font-weight:900;background:linear-gradient(135deg,var(--gold),var(--violet),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.nav-logo span{font-style:italic}
.nav-right{display:flex;align-items:center;gap:12px}
.streak-badge{display:flex;align-items:center;gap:6px;padding:7px 14px;background:linear-gradient(135deg,rgba(240,192,96,0.15),rgba(240,192,96,0.05));border:1px solid rgba(240,192,96,0.3);border-radius:100px;font-size:13px;font-weight:600;color:var(--gold)}
.credits-badge{display:flex;align-items:center;gap:6px;padding:7px 14px;background:rgba(139,92,246,0.1);border:1px solid rgba(139,92,246,0.3);border-radius:100px;font-size:13px;font-weight:600;color:#A78BFA}
.pro-btn{padding:8px 20px;background:linear-gradient(135deg,var(--gold),#E0A030);border:none;border-radius:100px;font-family:'Outfit',sans-serif;font-weight:700;font-size:13px;color:var(--bg);cursor:pointer;transition:all 0.2s;box-shadow:0 0 20px rgba(240,192,96,0.3)}
.pro-btn:hover{transform:translateY(-2px);box-shadow:0 4px 30px rgba(240,192,96,0.4)}

/* HERO */
#hero{padding:48px 32px 32px;max-width:900px;margin:0 auto;width:100%}
.hero-greeting{font-family:'Playfair Display',serif;font-size:clamp(28px,5vw,52px);font-weight:700;line-height:1.15;margin-bottom:10px}
.hero-greeting em{font-style:italic;color:var(--gold)}
.hero-sub{font-size:15px;color:var(--text-mid);margin-bottom:40px;font-weight:300}

/* CHECK-IN CARD */
#checkin-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:32px;box-shadow:0 20px 60px rgba(0,0,0,0.4);position:relative;overflow:hidden}
#checkin-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--violet),var(--pink),var(--gold))}
.checkin-label{font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--text-dim);margin-bottom:16px}
.mood-section{margin-bottom:28px}
.mood-section h3{font-size:15px;font-weight:600;margin-bottom:14px;color:var(--text-mid)}
.mood-emojis{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px}
.mood-emoji{width:52px;height:52px;background:var(--surface2);border:2px solid var(--border);border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:22px;cursor:pointer;transition:all 0.2s;position:relative}
.mood-emoji:hover{transform:scale(1.15);border-color:var(--border2)}
.mood-emoji.selected{border-color:var(--violet);background:rgba(139,92,246,0.15);transform:scale(1.2);box-shadow:0 0 20px rgba(139,92,246,0.3)}
.mood-emoji .emoji-label{position:absolute;bottom:-22px;left:50%;transform:translateX(-50%);font-size:10px;color:var(--text-dim);white-space:nowrap;font-weight:500}
.energy-slider-wrap{margin-top:12px}
.slider-label{display:flex;justify-content:space-between;margin-bottom:8px;font-size:12px;color:var(--text-dim)}
input[type=range]{width:100%;height:6px;-webkit-appearance:none;appearance:none;background:linear-gradient(90deg,var(--violet),var(--pink));border-radius:99px;outline:none;cursor:pointer}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:22px;height:22px;background:var(--text);border-radius:50%;box-shadow:0 2px 8px rgba(0,0,0,0.4);transition:transform 0.15s}
input[type=range]::-webkit-slider-thumb:hover{transform:scale(1.2)}
.journal-section{margin-bottom:28px}
.journal-section h3{font-size:15px;font-weight:600;margin-bottom:12px;color:var(--text-mid)}
#journal-text{width:100%;min-height:100px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius-sm);padding:16px;font-family:'Outfit',sans-serif;font-size:14px;color:var(--text);line-height:1.7;resize:vertical;outline:none;transition:border-color 0.2s}
#journal-text:focus{border-color:var(--violet)}
#journal-text::placeholder{color:var(--text-dim)}
.word-tags{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:28px}
.word-tag{padding:7px 16px;background:var(--bg2);border:1px solid var(--border);border-radius:100px;font-size:12px;font-weight:500;color:var(--text-mid);cursor:pointer;transition:all 0.2s}
.word-tag:hover,.word-tag.selected{border-color:var(--pink);color:var(--pink);background:rgba(236,72,153,0.08)}
#generate-btn{width:100%;padding:18px;background:linear-gradient(135deg,var(--violet),var(--pink));border:none;border-radius:var(--radius-sm);font-family:'Outfit',sans-serif;font-weight:700;font-size:16px;color:#fff;cursor:pointer;transition:all 0.3s;display:flex;align-items:center;justify-content:center;gap:10px;box-shadow:0 8px 30px rgba(139,92,246,0.3);letter-spacing:0.5px}
#generate-btn:hover{transform:translateY(-3px);box-shadow:0 12px 40px rgba(139,92,246,0.4)}
#generate-btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}
.btn-spin{width:18px;height:18px;border:2px solid rgba(255,255,255,0.3);border-top-color:#fff;border-radius:50%;animation:spin 0.7s linear infinite;display:none}
#generate-btn.loading .btn-spin{display:block}
@keyframes spin{to{transform:rotate(360deg)}}

/* ERROR BANNER */
#error-banner{background:rgba(255,68,85,0.1);border:1px solid rgba(255,68,85,0.3);border-radius:var(--radius-sm);padding:14px 18px;margin-bottom:20px;font-size:13px;color:#FF8090;display:none}

/* PORTRAIT */
#portrait-result{max-width:900px;margin:0 auto 48px;width:100%;padding:0 32px}
.portrait-container{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;box-shadow:0 24px 80px rgba(0,0,0,0.5);animation:rise 0.6s ease}
@keyframes rise{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
.portrait-header{padding:24px 28px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.portrait-title{font-family:'Playfair Display',serif;font-size:22px;font-weight:700}
.portrait-date{font-size:12px;color:var(--text-dim);margin-top:3px}
.portrait-actions{display:flex;gap:8px}
.action-btn{padding:8px 16px;background:var(--surface2);border:1px solid var(--border2);border-radius:var(--radius-sm);font-family:'Outfit',sans-serif;font-size:12px;font-weight:600;color:var(--text-mid);cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:6px}
.action-btn:hover{border-color:var(--violet);color:var(--violet)}
.action-btn.share{background:linear-gradient(135deg,rgba(139,92,246,0.15),rgba(236,72,153,0.1));border-color:rgba(139,92,246,0.3);color:#A78BFA}
.portrait-body{display:grid;grid-template-columns:1fr 1fr;gap:0}
.soul-canvas-wrap{padding:28px;border-right:1px solid var(--border);display:flex;flex-direction:column;align-items:center;gap:16px}
#soul-canvas{width:100%;max-width:320px;height:320px;border-radius:16px;box-shadow:0 0 40px rgba(0,0,0,0.6)}
.canvas-caption{font-size:12px;color:var(--text-dim);text-align:center;font-style:italic}
.ai-reading{padding:28px;display:flex;flex-direction:column;gap:20px}
.reading-section h4{font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--text-dim);margin-bottom:10px}
.reading-section p{font-size:14px;line-height:1.75;color:var(--text-mid)}
.mood-chips{display:flex;gap:8px;flex-wrap:wrap}
.mood-chip{padding:5px 14px;border-radius:100px;font-size:12px;font-weight:600}
.insight-card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius-sm);padding:16px}
.insight-card p{font-size:13.5px;line-height:1.7;color:var(--text-mid)}
.insight-label{font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--violet);margin-bottom:8px}
.affirmation-box{border-top:1px solid var(--border);padding:24px 28px;background:linear-gradient(135deg,rgba(139,92,246,0.05),rgba(236,72,153,0.05));text-align:center}
.affirmation-box p{font-family:'Playfair Display',serif;font-size:18px;font-style:italic;line-height:1.6;color:var(--gold2)}

/* GALLERY */
#gallery-section{max-width:900px;margin:0 auto 64px;width:100%;padding:0 32px}
.section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px}
.section-title{font-family:'Playfair Display',serif;font-size:26px;font-weight:700}
.section-title em{font-style:italic;color:var(--violet)}
.gallery-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:16px}
.gallery-item{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);overflow:hidden;cursor:pointer;transition:all 0.3s;animation:fadeIn 0.4s ease}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.gallery-item:hover{transform:translateY(-6px);border-color:var(--border2);box-shadow:0 12px 40px rgba(0,0,0,0.4)}
.gallery-canvas-wrap{padding:16px}
.gallery-canvas{width:100%;aspect-ratio:1;border-radius:10px}
.gallery-meta{padding:0 16px 16px}
.gallery-meta .g-date{font-size:11px;color:var(--text-dim);margin-bottom:4px}
.gallery-meta .g-mood{font-size:13px;font-weight:600;color:var(--text-mid)}
.gallery-empty{grid-column:1/-1;text-align:center;padding:48px;color:var(--text-dim);font-size:14px;line-height:1.8}

/* PREMIUM MODAL */
#premium-modal{position:fixed;inset:0;z-index:999;background:rgba(0,0,0,0.85);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;padding:24px;opacity:0;pointer-events:none;transition:opacity 0.3s}
#premium-modal.open{opacity:1;pointer-events:all}
.modal-card{background:var(--surface);border:1px solid var(--border2);border-radius:var(--radius);max-width:500px;width:100%;overflow:hidden;box-shadow:0 40px 100px rgba(0,0,0,0.6);transform:scale(0.95);transition:transform 0.3s}
#premium-modal.open .modal-card{transform:scale(1)}
.modal-gradient{height:8px;background:linear-gradient(90deg,var(--violet),var(--pink),var(--gold))}
.modal-body{padding:36px}
.modal-body h2{font-family:'Playfair Display',serif;font-size:28px;font-weight:900;margin-bottom:8px}
.modal-body h2 em{font-style:italic;color:var(--gold)}
.modal-sub{font-size:14px;color:var(--text-mid);margin-bottom:32px;line-height:1.6}
.plan-cards{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:24px}
.plan-card{background:var(--bg2);border:2px solid var(--border);border-radius:var(--radius-sm);padding:20px;cursor:pointer;transition:all 0.2s}
.plan-card:hover,.plan-card.active{border-color:var(--violet);background:rgba(139,92,246,0.08)}
.plan-card.featured{border-color:var(--gold)}
.plan-card.featured.active,.plan-card.featured:hover{background:rgba(240,192,96,0.08)}
.plan-label{font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--text-dim);margin-bottom:6px}
.plan-price{font-size:28px;font-weight:800;margin-bottom:4px}
.plan-price span{font-size:14px;font-weight:400;color:var(--text-dim)}
.plan-features{font-size:12px;color:var(--text-dim);line-height:1.8;margin-top:12px}
.plan-features li{list-style:none;padding-left:18px;position:relative}
.plan-features li::before{content:'‚ú¶';position:absolute;left:0;color:var(--violet);font-size:10px;top:2px}
.plan-card.featured .plan-features li::before{color:var(--gold)}
.modal-cta{width:100%;padding:16px;background:linear-gradient(135deg,var(--violet),var(--pink));border:none;border-radius:var(--radius-sm);font-family:'Outfit',sans-serif;font-weight:700;font-size:15px;color:#fff;cursor:pointer;transition:all 0.2s;margin-bottom:12px}
.modal-cta:hover{opacity:0.9;transform:translateY(-2px)}
.modal-close{width:100%;padding:10px;background:none;border:none;font-family:'Outfit',sans-serif;font-size:13px;color:var(--text-dim);cursor:pointer;transition:color 0.2s}
.modal-close:hover{color:var(--text)}

/* TOAST */
#toast{position:fixed;bottom:32px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--surface);border:1px solid var(--border2);border-radius:var(--radius-sm);padding:14px 24px;font-size:14px;font-weight:500;box-shadow:0 8px 30px rgba(0,0,0,0.4);transition:transform 0.4s ease;z-index:9999;white-space:nowrap}
#toast.show{transform:translateX(-50%) translateY(0)}

/* SUGGESTION CHIPS */
.suggestion-chips{display:flex;flex-wrap:wrap;gap:8px;padding:16px 0 28px}
.chip{padding:7px 14px;background:var(--surface2);border:1px solid var(--border2);border-radius:100px;font-size:12px;color:var(--text-mid);cursor:pointer;transition:all 0.2s}
.chip:hover{border-color:var(--violet);color:var(--violet);background:rgba(139,92,246,0.06)}

::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:99px}

@media(max-width:680px){
  .portrait-body{grid-template-columns:1fr}
  .soul-canvas-wrap{border-right:none;border-bottom:1px solid var(--border)}
  .plan-cards{grid-template-columns:1fr}
  nav{padding:12px 16px}
  #hero,#portrait-result,#gallery-section{padding-left:16px;padding-right:16px}
  .portrait-actions{flex-wrap:wrap}
}
</style>
</head>
<body>
<canvas id="stars-canvas"></canvas>
<div id="app">

<nav>
  <div class="nav-logo">Mood<span>verse</span></div>
  <div class="nav-right">
    <div class="streak-badge">üî• <span id="streak-count">0</span> Day Streak</div>
    <div class="credits-badge">‚ú¶ <span id="credits-count">3</span> Credits</div>
    <button class="pro-btn" onclick="openPremium()">‚ú¶ Go PRO</button>
  </div>
</nav>

<section id="hero">
  <div class="hero-greeting" id="greeting">How are you <em>really</em> feeling today?</div>
  <p class="hero-sub">Check in with your soul. Generate your unique emotional portrait. Build your inner universe.</p>

  <div class="suggestion-chips">
    <div class="chip" onclick="quickFill('Joyful',8,['Creative','Present'])">üòÑ Feeling joyful today</div>
    <div class="chip" onclick="quickFill('Anxious',4,['Overwhelmed','Conflicted'])">üò∞ A bit anxious</div>
    <div class="chip" onclick="quickFill('Calm',6,['Peaceful','Present'])">üòå Calm and centered</div>
    <div class="chip" onclick="quickFill('Inspired',9,['Creative','Powerful'])">ü§© Feeling inspired</div>
  </div>

  <div id="checkin-card">
    <div class="checkin-label">‚ú¶ Today's Check-in</div>
    <div id="error-banner"></div>

    <div class="mood-section">
      <h3>Pick your core emotion</h3>
      <div class="mood-emojis">
        <div class="mood-emoji" data-mood="Joyful" onclick="selectMood(this)">üòÑ<span class="emoji-label">Joyful</span></div>
        <div class="mood-emoji" data-mood="Calm" onclick="selectMood(this)">üòå<span class="emoji-label">Calm</span></div>
        <div class="mood-emoji" data-mood="Anxious" onclick="selectMood(this)">üò∞<span class="emoji-label">Anxious</span></div>
        <div class="mood-emoji" data-mood="Melancholic" onclick="selectMood(this)">üòî<span class="emoji-label">Sad</span></div>
        <div class="mood-emoji" data-mood="Angry" onclick="selectMood(this)">üò§<span class="emoji-label">Angry</span></div>
        <div class="mood-emoji" data-mood="Inspired" onclick="selectMood(this)">ü§©<span class="emoji-label">Inspired</span></div>
        <div class="mood-emoji" data-mood="Grateful" onclick="selectMood(this)">ü•π<span class="emoji-label">Grateful</span></div>
        <div class="mood-emoji" data-mood="Numb" onclick="selectMood(this)">üò∂<span class="emoji-label">Numb</span></div>
        <div class="mood-emoji" data-mood="Restless" onclick="selectMood(this)">ü´®<span class="emoji-label">Restless</span></div>
        <div class="mood-emoji" data-mood="Hopeful" onclick="selectMood(this)">üåü<span class="emoji-label">Hopeful</span></div>
      </div>
    </div>

    <div class="mood-section energy-slider-wrap">
      <h3>Energy level</h3>
      <div class="slider-label"><span>Depleted ü™´</span><span id="energy-val">5 / 10</span><span>Energized ‚ö°</span></div>
      <input type="range" id="energy-slider" min="1" max="10" value="5" oninput="document.getElementById('energy-val').textContent=this.value+' / 10'"/>
    </div>

    <div class="journal-section">
      <h3>What's on your mind? <span style="color:var(--text-dim);font-weight:300;font-size:13px">(optional)</span></h3>
      <textarea id="journal-text" placeholder="Write anything‚Ä¶ a thought, a feeling, a dream. Your words shape your portrait."></textarea>
    </div>

    <div class="mood-section">
      <h3>Add descriptors</h3>
      <div class="word-tags">
        <div class="word-tag" onclick="toggleTag(this)">Overwhelmed</div>
        <div class="word-tag" onclick="toggleTag(this)">Creative</div>
        <div class="word-tag" onclick="toggleTag(this)">Disconnected</div>
        <div class="word-tag" onclick="toggleTag(this)">Focused</div>
        <div class="word-tag" onclick="toggleTag(this)">Lost</div>
        <div class="word-tag" onclick="toggleTag(this)">Present</div>
        <div class="word-tag" onclick="toggleTag(this)">Lonely</div>
        <div class="word-tag" onclick="toggleTag(this)">Powerful</div>
        <div class="word-tag" onclick="toggleTag(this)">Sensitive</div>
        <div class="word-tag" onclick="toggleTag(this)">Curious</div>
        <div class="word-tag" onclick="toggleTag(this)">Conflicted</div>
        <div class="word-tag" onclick="toggleTag(this)">Peaceful</div>
      </div>
    </div>

    <button id="generate-btn" onclick="generatePortrait()">
      <div class="btn-spin"></div>
      <span id="gen-label">‚ú¶ Generate My Soul Portrait</span>
    </button>
  </div>
</section>

<section id="portrait-result"></section>

<section id="gallery-section">
  <div class="section-header">
    <div class="section-title">Your <em>Universe</em></div>
  </div>
  <div class="gallery-grid" id="gallery-grid"></div>
</section>

</div><!-- /#app -->

<!-- Premium Modal -->
<div id="premium-modal">
  <div class="modal-card">
    <div class="modal-gradient"></div>
    <div class="modal-body">
      <h2>Unlock Your Full <em>Universe</em></h2>
      <p class="modal-sub">Free users get 3 soul portraits per week. Go PRO for unlimited portraits, rare cosmic themes, and your full emotional history.</p>
      <div class="plan-cards">
        <div class="plan-card" onclick="selectPlan(this)">
          <div class="plan-label">Monthly</div>
          <div class="plan-price">$4.99<span>/mo</span></div>
          <ul class="plan-features">
            <li>Unlimited portraits</li>
            <li>10 cosmic themes</li>
            <li>Full mood history</li>
            <li>Downloadable art</li>
          </ul>
        </div>
        <div class="plan-card featured active" onclick="selectPlan(this)">
          <div class="plan-label" style="color:var(--gold)">‚≠ê Yearly ‚Äî Best Value</div>
          <div class="plan-price" style="color:var(--gold)">$2.99<span>/mo</span></div>
          <ul class="plan-features">
            <li>Everything in Monthly</li>
            <li>50+ themes unlocked</li>
            <li>AI mood trend reports</li>
            <li>Priority generation</li>
          </ul>
        </div>
      </div>
      <button class="modal-cta">‚ú¶ Start 7-Day Free Trial</button>
      <button class="modal-close" onclick="closePremium()">Maybe later</button>
    </div>
  </div>
</div>

<div id="toast"></div>

<script>
// ‚îÄ‚îÄ Stars ‚îÄ‚îÄ
(function(){
  const c=document.getElementById('stars-canvas'),ctx=c.getContext('2d');let stars=[];
  function resize(){c.width=innerWidth;c.height=innerHeight;}
  function init(){stars=[];for(let i=0;i<200;i++)stars.push({x:Math.random()*c.width,y:Math.random()*c.height,r:Math.random()*1.4+0.2,a:Math.random(),da:(Math.random()-0.5)*0.003});}
  function draw(){ctx.clearRect(0,0,c.width,c.height);stars.forEach(s=>{s.a+=s.da;if(s.a<=0||s.a>=1)s.da*=-1;ctx.beginPath();ctx.arc(s.x,s.y,s.r,0,Math.PI*2);ctx.fillStyle=`rgba(200,210,255,${s.a})`;ctx.fill();});requestAnimationFrame(draw);}
  resize();init();draw();addEventListener('resize',()=>{resize();init();});
})();

// ‚îÄ‚îÄ State ‚îÄ‚îÄ
let credits=parseInt(localStorage.getItem('mv_credits')||'3');
let streak=parseInt(localStorage.getItem('mv_streak')||'0');
let gallery=JSON.parse(localStorage.getItem('mv_gallery')||'[]');
let selectedMood='';
let selectedTags=[];

function init(){
  document.getElementById('credits-count').textContent=credits;
  document.getElementById('streak-count').textContent=streak;
  const h=new Date().getHours();
  const g=h<12?'Good morning.':h<17?'Good afternoon.':'Good evening.';
  document.getElementById('greeting').innerHTML=`${g} How are you <em>really</em> feeling today?`;
  renderGallery();
}

function selectMood(el){
  document.querySelectorAll('.mood-emoji').forEach(e=>e.classList.remove('selected'));
  el.classList.add('selected');
  selectedMood=el.dataset.mood;
}
function toggleTag(el){
  el.classList.toggle('selected');
  const t=el.textContent;
  if(el.classList.contains('selected'))selectedTags.push(t);
  else selectedTags=selectedTags.filter(x=>x!==t);
}
function quickFill(mood,energy,tags){
  document.querySelectorAll('.mood-emoji').forEach(e=>{if(e.dataset.mood===mood){e.classList.add('selected');selectedMood=mood;}else e.classList.remove('selected');});
  document.getElementById('energy-slider').value=energy;
  document.getElementById('energy-val').textContent=energy+' / 10';
  selectedTags=[];
  document.querySelectorAll('.word-tag').forEach(el=>{el.classList.remove('selected');if(tags.includes(el.textContent)){el.classList.add('selected');selectedTags.push(el.textContent);}});
  document.getElementById('checkin-card').scrollIntoView({behavior:'smooth'});
}
function selectPlan(el){document.querySelectorAll('.plan-card').forEach(c=>c.classList.remove('active'));el.classList.add('active');}
function openPremium(){document.getElementById('premium-modal').classList.add('open');}
function closePremium(){document.getElementById('premium-modal').classList.remove('open');}
document.getElementById('premium-modal').addEventListener('click',function(e){if(e.target===this)closePremium();});

function showError(msg){const b=document.getElementById('error-banner');b.textContent=msg;b.style.display='block';setTimeout(()=>b.style.display='none',5000);}

// ‚îÄ‚îÄ Generate ‚Äî calls OUR backend ‚îÄ‚îÄ
async function generatePortrait(){
  if(!selectedMood){showError('Please select your core emotion first.');return;}
  if(credits<=0){openPremium();return;}
  const btn=document.getElementById('generate-btn');
  btn.disabled=true;btn.classList.add('loading');
  document.getElementById('gen-label').textContent='Weaving your portrait‚Ä¶';
  document.getElementById('error-banner').style.display='none';
  try{
    const res=await fetch('/api/generate-portrait',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        mood:selectedMood,
        energy:parseInt(document.getElementById('energy-slider').value),
        tags:selectedTags,
        journal:document.getElementById('journal-text').value.trim()
      })
    });
    const data=await res.json();
    if(!res.ok||!data.success)throw new Error(data.error||'Generation failed');

    credits=Math.max(0,credits-1);
    localStorage.setItem('mv_credits',credits);
    document.getElementById('credits-count').textContent=credits;

    const today=new Date().toDateString();
    const last=localStorage.getItem('mv_last_day');
    const yesterday=new Date(Date.now()-86400000).toDateString();
    if(last===yesterday)streak++;else if(last!==today)streak=1;
    localStorage.setItem('mv_streak',streak);
    localStorage.setItem('mv_last_day',today);
    document.getElementById('streak-count').textContent=streak;

    showPortrait(data.reading);
  }catch(e){
    showError('‚ö†Ô∏è '+e.message);
  }
  btn.disabled=false;btn.classList.remove('loading');
  document.getElementById('gen-label').textContent='‚ú¶ Generate My Soul Portrait';
}

// ‚îÄ‚îÄ Canvas drawing ‚îÄ‚îÄ
function drawSoulCanvas(canvas,reading,small=false){
  const ctx=canvas.getContext('2d'),w=canvas.width,h=canvas.height;
  ctx.clearRect(0,0,w,h);
  const c1=reading.soul_color_primary||'#8B5CF6';
  const c2=reading.soul_color_secondary||'#EC4899';
  const c3=reading.soul_color_accent||'#F0C060';
  const bg=ctx.createRadialGradient(w/2,h/2,0,w/2,h/2,w*0.7);
  bg.addColorStop(0,ha(c1,0.3));bg.addColorStop(0.5,ha(c2,0.15));bg.addColorStop(1,'#07080F');
  ctx.fillStyle=bg;ctx.fillRect(0,0,w,h);
  const seed=reading.portrait_title.length;
  const energy=parseInt(document.getElementById('energy-slider')?.value||5);
  const count=small?6:12;
  for(let i=0;i<count;i++){
    const x=(Math.sin(i*2.3+seed)*0.5+0.5)*w,y=(Math.cos(i*1.7+seed)*0.5+0.5)*h;
    const r=w*(0.1+(i%3)*0.08)*(energy/10);
    const cols=[c1,c2,c3];
    const grd=ctx.createRadialGradient(x,y,0,x,y,r);
    grd.addColorStop(0,ha(cols[i%3],0.14));grd.addColorStop(1,ha(cols[i%3],0));
    ctx.beginPath();ctx.arc(x,y,r,0,Math.PI*2);ctx.fillStyle=grd;ctx.fill();
  }
  const ob=small?5:10;
  for(let i=0;i<ob;i++){
    const x=(Math.cos(i*1.4*(seed%7+1))*0.4+0.5)*w,y=(Math.sin(i*2.1)*0.4+0.5)*h;
    const r=(small?4:8)+(i%5)*(small?3:6);
    const g2=ctx.createRadialGradient(x,y,0,x,y,r);
    g2.addColorStop(0,ha([c1,c2,c3][i%3],0.7));g2.addColorStop(1,ha([c1,c2,c3][i%3],0));
    ctx.beginPath();ctx.arc(x,y,r,0,Math.PI*2);ctx.fillStyle=g2;ctx.fill();
  }
  if(!small){
    ctx.save();ctx.translate(w/2,h/2);
    for(let i=0;i<6;i++){
      const gg=ctx.createRadialGradient(Math.cos(i*Math.PI/3)*28,Math.sin(i*Math.PI/3)*28,0,Math.cos(i*Math.PI/3)*28,Math.sin(i*Math.PI/3)*28,14);
      gg.addColorStop(0,ha(c3,0.8));gg.addColorStop(1,ha(c3,0));
      ctx.beginPath();ctx.arc(Math.cos(i*Math.PI/3)*28,Math.sin(i*Math.PI/3)*28,12,0,Math.PI*2);ctx.fillStyle=gg;ctx.fill();
    }
    const cc=ctx.createRadialGradient(0,0,0,0,0,18);cc.addColorStop(0,c3);cc.addColorStop(1,ha(c3,0));
    ctx.beginPath();ctx.arc(0,0,18,0,Math.PI*2);ctx.fillStyle=cc;ctx.fill();
    ctx.restore();
  }
  const sc=small?20:70;
  for(let i=0;i<sc;i++){ctx.beginPath();ctx.arc(Math.random()*w,Math.random()*h,Math.random()*1.5,0,Math.PI*2);ctx.fillStyle=`rgba(200,210,255,${Math.random()*0.5})`;ctx.fill();}
}
function ha(hex,a){const r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);return `rgba(${r},${g},${b},${a})`;}

function showPortrait(reading){
  const s=document.getElementById('portrait-result');
  const date=new Date().toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric'});
  const chipColors=['var(--violet)','var(--pink)','var(--cyan)','var(--gold)','var(--emerald)'];
  const chipBgs=['rgba(139,92,246,0.15)','rgba(236,72,153,0.12)','rgba(34,211,238,0.12)','rgba(240,192,96,0.12)','rgba(16,185,129,0.12)'];
  const chips=(reading.mood_chips||[]).map((c,i)=>`<span class="mood-chip" style="background:${chipBgs[i%5]};color:${chipColors[i%5]};border:1px solid ${chipColors[i%5]}44">${c}</span>`).join('');
  s.innerHTML=`<div style="padding:0 32px"><div class="portrait-container">
    <div class="portrait-header">
      <div><div class="portrait-title">${reading.portrait_title}</div><div class="portrait-date">${date} ¬∑ ${selectedMood}</div></div>
      <div class="portrait-actions">
        <button class="action-btn" onclick="downloadPortrait()">‚¨á Save</button>
        <button class="action-btn share" onclick="sharePortrait()">‚ú¶ Share</button>
      </div>
    </div>
    <div class="portrait-body">
      <div class="soul-canvas-wrap">
        <canvas id="soul-canvas" width="320" height="320"></canvas>
        <div class="canvas-caption">‚ú¶ ${reading.inner_weather}</div>
      </div>
      <div class="ai-reading">
        <div class="reading-section"><h4>Soul Reading</h4><p>${reading.mood_summary}</p></div>
        <div class="reading-section"><h4>Your Energy</h4><p>${reading.energy_description}</p></div>
        <div class="reading-section"><h4>Emotional Landscape</h4><div class="mood-chips">${chips}</div></div>
        <div class="insight-card"><div class="insight-label">‚ú¶ Deep Insight</div><p>${reading.insight}</p></div>
      </div>
    </div>
    <div class="affirmation-box"><p>"${reading.affirmation}"</p></div>
  </div></div>`;
  const canvas=document.getElementById('soul-canvas');
  drawSoulCanvas(canvas,reading);
  saveToGallery(reading,canvas);
  s.scrollIntoView({behavior:'smooth',block:'start'});
}

function saveToGallery(reading,canvas){
  const entry={id:Date.now(),date:new Date().toLocaleDateString('en-US',{month:'short',day:'numeric'}),mood:selectedMood,title:reading.portrait_title,imageData:canvas.toDataURL(),reading};
  gallery.unshift(entry);if(gallery.length>20)gallery=gallery.slice(0,20);
  localStorage.setItem('mv_gallery',JSON.stringify(gallery));
  renderGallery();
}
function renderGallery(){
  const grid=document.getElementById('gallery-grid');
  if(!gallery.length){grid.innerHTML='<div class="gallery-empty">Your emotional universe awaits.<br>Generate your first portrait above. ‚ú¶</div>';return;}
  grid.innerHTML='';
  gallery.slice(0,8).forEach(e=>{
    const item=document.createElement('div');item.className='gallery-item';
    item.innerHTML=`<div class="gallery-canvas-wrap"><canvas class="gallery-canvas" width="200" height="200" id="gc-${e.id}"></canvas></div><div class="gallery-meta"><div class="g-date">${e.date}</div><div class="g-mood">${e.mood}</div></div>`;
    grid.appendChild(item);
    if(e.reading){
      const c=document.getElementById('gc-'+e.id);
      drawSoulCanvas(c,e.reading,true);
    }
  });
}
function sharePortrait(){
  navigator.clipboard.writeText(window.location.href).catch(()=>{});
  showToast('üîó Link copied! Share your Moodverse portrait ‚ú¶');
}
function downloadPortrait(){
  const c=document.getElementById('soul-canvas');
  if(!c){showToast('Generate a portrait first!');return;}
  const a=document.createElement('a');a.download='moodverse-portrait.png';a.href=c.toDataURL();a.click();
  showToast('‚ú¶ Portrait saved!');
}
function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),3500);}

init();
</script>
</body>
</html>
